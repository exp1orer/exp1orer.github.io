<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="定义视图函数及路由基础定义一个普通的视图函数及路由规则 1234567from flask import Flaskapp &#x3D; Flask(__name__)@app.route(&#39;&#x2F;hello&#39;)def hello():    return &#39;Hello World!&#39;  动态路由匹配 123@app.route(&#39;&#x2F;hello&#x2F;&lt;string:name&gt;&#39;)def hello(na">
<meta property="og:type" content="article">
<meta property="og:title" content="《Flask Web开发实战》笔记">
<meta property="og:url" content="http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Search is Null">
<meta property="og:description" content="定义视图函数及路由基础定义一个普通的视图函数及路由规则 1234567from flask import Flaskapp &#x3D; Flask(__name__)@app.route(&#39;&#x2F;hello&#39;)def hello():    return &#39;Hello World!&#39;  动态路由匹配 123@app.route(&#39;&#x2F;hello&#x2F;&lt;string:name&gt;&#39;)def hello(na">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnibu7cixdj315t0u0439.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnl56prilsj33az0u07df.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnl61rte0fj31730u0aes.jpg">
<meta property="article:published_time" content="2021-02-07T16:13:27.000Z">
<meta property="article:modified_time" content="2021-02-23T12:59:18.143Z">
<meta property="article:author" content="Search?&#x3D;Null">
<meta property="article:tag" content="Flask">
<meta property="article:tag" content="Python Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008eGmZEgy1gnibu7cixdj315t0u0439.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>《Flask Web开发实战》笔记</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="Search is Null" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/exp1orer" target="_blank" rel="noopener">项目</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/03/03/%E9%80%9A%E8%BE%BEOA-V11-7%E8%8E%B7%E5%8F%96%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7Session/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/01/16/ysoserial%E4%B9%8BCommonsCollections2-7-P3/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&text=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&is_video=false&description=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=《Flask Web开发实战》笔记&body=Check out this article: http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&name=《Flask Web开发实战》笔记&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&t=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义视图函数及路由"><span class="toc-number">1.</span> <span class="toc-text">定义视图函数及路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基础"><span class="toc-number">2.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图钩子"><span class="toc-number">3.</span> <span class="toc-text">视图钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP响应"><span class="toc-number">4.</span> <span class="toc-text">HTTP响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-response函数"><span class="toc-number">5.</span> <span class="toc-text">make_response函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Response对象"><span class="toc-number">6.</span> <span class="toc-text">Response对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask上下文变量"><span class="toc-number">7.</span> <span class="toc-text">Flask上下文变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板内置上下文"><span class="toc-number">8.</span> <span class="toc-text">模板内置上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板自定义上下文"><span class="toc-number">9.</span> <span class="toc-text">模板自定义上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JinJa2模板引擎全局函数"><span class="toc-number">10.</span> <span class="toc-text">JinJa2模板引擎全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask内置的模板全局函数"><span class="toc-number">11.</span> <span class="toc-text">Flask内置的模板全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义模板全局函数"><span class="toc-number">12.</span> <span class="toc-text">自定义模板全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器"><span class="toc-number">13.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义过滤器"><span class="toc-number">14.</span> <span class="toc-text">自定义过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试器"><span class="toc-number">15.</span> <span class="toc-text">测试器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义注册器"><span class="toc-number">16.</span> <span class="toc-text">自定义注册器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板环境对象"><span class="toc-number">17.</span> <span class="toc-text">模板环境对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部模板"><span class="toc-number">18.</span> <span class="toc-text">局部模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板继承"><span class="toc-number">19.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载静态文件"><span class="toc-number">20.</span> <span class="toc-text">加载静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消息闪现"><span class="toc-number">21.</span> <span class="toc-text">消息闪现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义错误页面"><span class="toc-number">22.</span> <span class="toc-text">自定义错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-WTF处理表单"><span class="toc-number">23.</span> <span class="toc-text">Flask-WTF处理表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义验证器"><span class="toc-number">24.</span> <span class="toc-text">自定义验证器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义通用验证器"><span class="toc-number">25.</span> <span class="toc-text">自定义通用验证器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传表单"><span class="toc-number">26.</span> <span class="toc-text">上传表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLAlchemy拓展"><span class="toc-number">27.</span> <span class="toc-text">SQLAlchemy拓展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现添加新笔记视图"><span class="toc-number">28.</span> <span class="toc-text">实现添加新笔记视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改首页视图和模板文件"><span class="toc-number">28.1.</span> <span class="toc-text">修改首页视图和模板文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编辑笔记内容"><span class="toc-number">28.2.</span> <span class="toc-text">编辑笔记内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除笔记"><span class="toc-number">28.3.</span> <span class="toc-text">删除笔记</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多表关系示例"><span class="toc-number">29.</span> <span class="toc-text">一对多表关系示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实战项目-SayHello"><span class="toc-number">30.</span> <span class="toc-text">实战项目-SayHello</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#蓝图"><span class="toc-number">31.</span> <span class="toc-text">蓝图</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        《Flask Web开发实战》笔记
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Search is Null</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-07T16:13:27.000Z" itemprop="datePublished">2021-02-08</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Flask/" rel="tag">Flask</a>, <a class="tag-link" href="/tags/Python-Web/" rel="tag">Python Web</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="定义视图函数及路由"><a href="#定义视图函数及路由" class="headerlink" title="定义视图函数及路由"></a>定义视图函数及路由</h3><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>定义一个普通的视图函数及路由规则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br></pre></td></tr></table></figure>

<p>动态路由匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/hello/&lt;string:name&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello %s!'</span> % name</span><br></pre></td></tr></table></figure>

<p>其他类型转换器：</p>
<ul>
<li>int        整型</li>
<li>float      浮点型</li>
<li>string     除/以外的字符串</li>
<li>path      包含/的字符串</li>
<li>uuid      UUID字符串</li>
<li>any       匹配一系列给定值中的一个元素</li>
</ul>
<p>any转换器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/color/&lt;any(blue, white, black):color&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice_color</span><span class="params">(color)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Your Choice %s!'</span> % color</span><br></pre></td></tr></table></figure>

<p>视图函数默认会监听GET/POST/HEAD的请求方法, 如果想限制视图函数只能通过某个方法访问可以通过<code>methods</code>参数限制, 其类型为一个列表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/hello', methods=['GET', 'POST'])</span></span><br></pre></td></tr></table></figure>

<h3 id="视图钩子"><a href="#视图钩子" class="headerlink" title="视图钩子"></a>视图钩子</h3><p>每个钩子可以处理多个函数, 函数名无需和钩子名一致。</p>
<table>
<thead>
<tr>
<th>钩子</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>before_first_request</td>
<td>注册一个函数, 在处理第一次请求时运行</td>
</tr>
<tr>
<td>before_request</td>
<td>在处理每次请求书时运行</td>
</tr>
<tr>
<td>after_request</td>
<td>如果没有未处理的异常抛出则会在每个请求结束后运行</td>
</tr>
<tr>
<td>teardown_request</td>
<td>即时出现未处理的异常也会在每个请求结束后运行。如果发生异常则会把异常对象传入到注册的函数中</td>
</tr>
<tr>
<td>after_this_request</td>
<td>在视图函数内注册一个函数, 会在这个请求结束后运行</td>
</tr>
</tbody></table>
<h3 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h3><p>视图函数的返回值可以自定义响应内容如指定响应状态码为201:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/hello')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello!'</span>, <span class="number">201</span></span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnibu7cixdj315t0u0439.jpg" alt=""></p>
<p>自定义响应状态码及响应头：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">follow</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>, <span class="number">302</span>, &#123;<span class="string">'Location'</span>: <span class="string">'https://www.baidu.com'</span>&#125;</span><br></pre></td></tr></table></figure>

<p>使用redirect函数重定向：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'https://www.baidu.com'</span>)</span><br></pre></td></tr></table></figure>

<p>redirect + url_for 重定向到其他视图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redirect_hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'hello'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="make-response函数"><a href="#make-response函数" class="headerlink" title="make_response函数"></a>make_response函数</h3><p>使用make_response函数生成响应对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/foo')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">'Join'</span>,</span><br><span class="line">        <span class="string">'age'</span>: <span class="number">21</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = make_response(json.dumps(data))</span><br><span class="line">    response.mimetype = <span class="string">'application/json'</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>jsonify函数简化上述操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(&#123;<span class="string">'name'</span>: <span class="string">'Join'</span>, <span class="string">'age'</span>: <span class="number">21</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h3><table>
<thead>
<tr>
<th>方法/属性</th>
<th>说 明</th>
</tr>
</thead>
<tbody><tr>
<td>headers</td>
<td>WerkZeug 的 Headers对象, 表示响应头, 可以像字典操作</td>
</tr>
<tr>
<td>status</td>
<td>状态码, 文本型</td>
</tr>
<tr>
<td>status_code</td>
<td>状态码, 整型</td>
</tr>
<tr>
<td>mimetype</td>
<td>MIME类型</td>
</tr>
<tr>
<td>set_cookie()</td>
<td>设置Cookie</td>
</tr>
</tbody></table>
<h3 id="Flask上下文变量"><a href="#Flask上下文变量" class="headerlink" title="Flask上下文变量"></a>Flask上下文变量</h3><table>
<thead>
<tr>
<th>变 量 名</th>
<th>上下文类别</th>
<th>说  明</th>
</tr>
</thead>
<tbody><tr>
<td>current_app</td>
<td>程序上下文</td>
<td>指向处理请求的上下文实例</td>
</tr>
<tr>
<td>g</td>
<td>程序上下文</td>
<td>替代Python 的全局变量用法, 确保仅在当前请求中可用。用于存储全局数据, 每次请求都会重置</td>
</tr>
<tr>
<td>request</td>
<td>请求上下文</td>
<td>封装客户端发出的请求报文数据</td>
</tr>
<tr>
<td>session</td>
<td>请求上下文</td>
<td>用于记住请求之间的数据, 通过签名的Cookie实现</td>
</tr>
</tbody></table>
<p>上图四个对象为真实对象的代理对象, 即通过代理对象（Proxy Object）访问真实对象。如果需要获取真实对象可以通过调用代理对象的_get_current_object()方法获取。</p>
<h3 id="模板内置上下文"><a href="#模板内置上下文" class="headerlink" title="模板内置上下文"></a>模板内置上下文</h3><p>Flask中使用的模板引擎为<code>JinJa2</code>, Flask在模板上下文中提供了一些内置变量, 可以在模板中直接使用。</p>
<table>
<thead>
<tr>
<th>变    量</th>
<th>说    明</th>
</tr>
</thead>
<tbody><tr>
<td>config</td>
<td>当前的配置对象</td>
</tr>
<tr>
<td>request</td>
<td>当前的请求对象, 在已激活的请求环境下可用</td>
</tr>
<tr>
<td>sessio</td>
<td>当前的会话对象, 在已激活的请求环境下可用</td>
</tr>
<tr>
<td>g</td>
<td>与请求绑定的全局变量, 在已激活的请求环境下可用</td>
</tr>
</tbody></table>
<h3 id="模板自定义上下文"><a href="#模板自定义上下文" class="headerlink" title="模板自定义上下文"></a>模板自定义上下文</h3><p>如果多个模板需要使用同一变量时, 避免在视图函数中重复传递变量, 更好的方法是设置一个模板全局变量。Flask提供了一个app.context_processor装饰器, 可以用来注册模板上下文处理函数。它可以帮我们完成统一传入变量的工作。模板上下文处理函数需要返回一个键值对的字典。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inject_foo</span><span class="params">()</span>:</span></span><br><span class="line">    foo = <span class="string">'I am foo'</span></span><br><span class="line">    <span class="keyword">return</span> dict(foo=foo)</span><br></pre></td></tr></table></figure>

<p>当调用<code>render_template</code>渲染任意一个模板时, 所有使用<code>app.context_processor</code>装饰器注册的模板上下文处理函数都会被执行。这些函数的返回值会被添加到模板中可直接使用。</p>
<p>除了装饰器的方法以外, 你也可以直接调用该函数传入对象以注册。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inject_foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dict(foo=foo)</span><br><span class="line">app.context_processor(inject_foo)</span><br></pre></td></tr></table></figure>

<h3 id="JinJa2模板引擎全局函数"><a href="#JinJa2模板引擎全局函数" class="headerlink" title="JinJa2模板引擎全局函数"></a>JinJa2模板引擎全局函数</h3><p><a href="http://jinja.pocoo.org/docs/2.10/templates/#list-of-global-functions" target="_blank" rel="noopener">全局函数列表</a></p>
<h3 id="Flask内置的模板全局函数"><a href="#Flask内置的模板全局函数" class="headerlink" title="Flask内置的模板全局函数"></a>Flask内置的模板全局函数</h3><table>
<thead>
<tr>
<th>函    数</th>
<th>说    明</th>
</tr>
</thead>
<tbody><tr>
<td>url_for()</td>
<td>生成URL</td>
</tr>
<tr>
<td>get_flashed_messages</td>
<td>用于获取flash消息</td>
</tr>
</tbody></table>
<h3 id="自定义模板全局函数"><a href="#自定义模板全局函数" class="headerlink" title="自定义模板全局函数"></a>自定义模板全局函数</h3><p>方式一：app.template_global装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.template_global</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'I am foo'</span></span><br></pre></td></tr></table></figure>

<p>方式二：app.add_template_global函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可选的name参数</span></span><br><span class="line">app.add_template_global(func[,name])</span><br></pre></td></tr></table></figure>

<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p>在Jinja2中，过滤器（filter）是一些可以用来修改和过滤变量值的特殊函数，过滤器和变量用一个竖线（管道符号）隔开，需要参数的过滤器可以像函数一样使用括号传递。下面是一个对name变量使用title过滤器的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; name|title &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>另一种用法是使用标签声明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% filter upper %&#125;</span><br><span class="line">    This text becomes uppercase.</span><br><span class="line">&#123;% endfilter %&#125;</span><br></pre></td></tr></table></figure>

<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#builtin-filters" target="_blank" rel="noopener">完整过滤器列表</a></p>
<p>同时使用多个过滤器</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Hello, &#123;&#123; name|default('默认值')|title &#125;&#125;!&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>不对变量进行转义的两种方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; sanitized|safe &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>转换为Markup对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Markup</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    text = Markup(<span class="string">'&lt;h1&gt;Hello, Flask!&lt;/h1&gt;'</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, text=text)</span><br></pre></td></tr></table></figure>

<h3 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><p>使用<code>app.template_filter</code>装饰器可以注册自定义过滤器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Markup</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.template_filter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">musical</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> s + Markup(<span class="string">'&amp;#9835;'</span>)</span><br></pre></td></tr></table></figure>

<p>和注册全局函数类型, 可以使用<code>name</code>可选参数为过滤器命名, 默认则为函数名称。</p>
<h3 id="测试器"><a href="#测试器" class="headerlink" title="测试器"></a>测试器</h3><p>测试器（Test）可用于测试一些变量或表达式, 返回布尔值类型（True or False）的特殊函数。例如使用<code>number</code>测试一个变量是否为数字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> age <span class="keyword">is</span> number %&#125;</span><br><span class="line">    &#123;&#123; age * <span class="number">365</span> &#125;&#125;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">    无效数字</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p><a href="http://jinja.pocoo.org/docs/2.10/templates/#list-of-builtin-tests" target="_blank" rel="noopener">完整测试器列表</a></p>
<p>如果测试器包含多个参数则可以使用如下两种形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># One</span></span><br><span class="line">&#123;% <span class="keyword">if</span> foo <span class="keyword">is</span> sameas(bar) %&#125;</span><br><span class="line"><span class="comment"># Two</span></span><br><span class="line">&#123;% <span class="keyword">if</span> foo <span class="keyword">is</span> sameas bar %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义注册器"><a href="#自定义注册器" class="headerlink" title="自定义注册器"></a>自定义注册器</h3><p>跟前面的步骤一样, 代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.template_test()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baz</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="string">'baz'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="模板环境对象"><a href="#模板环境对象" class="headerlink" title="模板环境对象"></a>模板环境对象</h3><p>在Jinja2中，渲染行为由jinja2.Enviroment类控制，所有的配置选项、上下文变量、全局函数、过滤器和测试器都存储在Enviroment实例上。当与Flask结合后，我们并不单独创建Enviroment对象，而是使用Flask创建的Enviroment对象，它存储在app.jinja_env属性上。</p>
<p>在程序中，我们可以使用app.jinja_env更改Jinja2设置。比如，你可以自定义所有的定界符。下面使用variable_start_string和variable_end_string分别自定义变量定界符的开始和结束符号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">app.jinja_env.variable_start_string = <span class="string">'[['</span></span><br><span class="line">app.jinja_env.variable_end_string = <span class="string">']]'</span></span><br></pre></td></tr></table></figure>

<hr>
<p>模板环境中的全局函数、过滤器和测试器分别存储在Enviroment对象的globals、filters和tests属性中，这三个属性都是字典对象。除了使用Flask提供的装饰器和方法注册自定义函数，我们也可以直接操作这三个字典来添加相应的函数或变量，这通过向对应的字典属性中添加一个键值对实现，传入模板的名称作为键，对应的函数对象或变量作为值。下面是几个简单的示例。</p>
<p><strong>添加自定义注册对象</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'I am bar.'</span></span><br><span class="line">foo = <span class="string">'I am foo'</span></span><br><span class="line">app.jinja_env.globals[<span class="string">'bar'</span>] = bar</span><br><span class="line">app.jinja_env.globals[<span class="string">'foo'</span>] = foo</span><br></pre></td></tr></table></figure>

<p><strong>添加自定义过滤器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">smiling</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> s + <span class="string">' :)'</span></span><br><span class="line">app.jinja_env.filters[<span class="string">'smiling'</span>] = smiling</span><br></pre></td></tr></table></figure>

<p><strong>添加自定义测试器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baz</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="string">'baz'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">app.jinja_env.tests[<span class="string">'baz'</span>] = baz</span><br></pre></td></tr></table></figure>

<p><a href="http://jinja.pocoo.org/docs/latest/api/#jinja2.Environment" target="_blank" rel="noopener">Enviroment</a></p>
<h3 id="局部模板"><a href="#局部模板" class="headerlink" title="局部模板"></a>局部模板</h3><p>通常在Web应用程序中会出现很多模板代码复用的问题, 例如需要在多个模板中显示另一个模板的内容（假设为首页模板）此时如果在每个模板中都重复编写代码则会造成冗余且不易维护。因此可以定义一个局部模板, 当多个模板需要使用相同的内容时只需包含该模板即可。</p>
<p>Tip: 为了区分局部模板, 通常使用前导下划线命名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include <span class="string">'_banner.html'</span> %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><p>简单理解为局部模板的Plus版就好了。</p>
<p><strong>编写基模板, 使用block和endblock标签声明</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  &#123;% block head %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span> &#123;% block title %&#125;Template - HelloFlask &#123;% endblock title %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  &#123;% endblock head %&#125;</span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('index') &#125;&#125;"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">  &#123;% block context %&#125;</span><br><span class="line">  </span><br><span class="line">  &#123;% endblock context %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当子模板继承基模板后, 子模板会自动包含基模板的内容和结构, 通过声明标签的形式可以修改基模板中的内容。如果在子模板中修改了基模板定义的块则会覆盖。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Template<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% block context %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>DoSomethink<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock context %&#125;</span><br></pre></td></tr></table></figure>

<p>追加内容（不会覆盖基模板中原先定义的）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block context %&#125;</span><br><span class="line">  &#123;&#123; super() &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Chaned Somethink<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock context %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="加载静态文件"><a href="#加载静态文件" class="headerlink" title="加载静态文件"></a>加载静态文件</h3><p>在Flask项目的根目录下新建<code>static</code>文件夹, 便可使用<code>url_for</code>函数生成静态文件的URL。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设 app/static/avatar.jpg文件存在</span></span><br><span class="line">url_for(<span class="string">'static'</span>, filename=<span class="string">'avatar.jpg'</span>)</span><br></pre></td></tr></table></figure>

<p>而在模板文件中引入CSS则可以通过如下方式：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('static', filename='style.css') &#125;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="消息闪现"><a href="#消息闪现" class="headerlink" title="消息闪现"></a>消息闪现</h3><p>在视图函数中通过<code>flash</code>函数传递一个<code>闪现消息</code>, 该消息会存储在session中, 在模板文件中可以通过循环<code>get_flashed_message</code>函数的返回值获取消息。当调用该函数时存储在session中的消息便会销毁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/flash')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">just_flash</span><span class="params">()</span>:</span></span><br><span class="line">    flash(<span class="string">'I am flash, who is looking for me?'</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br></pre></td></tr></table></figure>

<p>模板文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for message in get_flashed_message() %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert"</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义错误页面"><a href="#自定义错误页面" class="headerlink" title="自定义错误页面"></a>自定义错误页面</h3><p>使用<code>app.errorhandler</code>装饰器传入指定的错误状态码装饰视图函数, 视图函数中需要接收异常对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(e)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'errors/404.html'</span>), <span class="number">404</span></span><br></pre></td></tr></table></figure>

<p><strong>异常对象常用属性</strong></p>
<table>
<thead>
<tr>
<th>属    性</th>
<th>说    明</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>状态码</td>
</tr>
<tr>
<td>name</td>
<td>原因短语</td>
</tr>
<tr>
<td>description</td>
<td>错误描述, 另外使用get_description()还可以获取HTML格式的错误描述的代码</td>
</tr>
</tbody></table>
<h3 id="Flask-WTF处理表单"><a href="#Flask-WTF处理表单" class="headerlink" title="Flask-WTF处理表单"></a>Flask-WTF处理表单</h3><p>安装拓展<code>pip install flask_wtf</code></p>
<table>
<thead>
<tr>
<th>字段类</th>
<th>说明</th>
<th>对应的HTML表示</th>
</tr>
</thead>
<tbody><tr>
<td>BooleanField</td>
<td>复选框, 值为True或False</td>
<td><input type="checkbox"></td>
</tr>
<tr>
<td>DateField</td>
<td>文本字段, 值会被处理为datetime.date对象</td>
<td><input type="text"></td>
</tr>
<tr>
<td>DateTimeField</td>
<td>文本字段, 值会被处理为datetime.datetime对象</td>
<td><input type="text"></td>
</tr>
<tr>
<td>FileFiled</td>
<td>文件上传字段</td>
<td><input type="file"></td>
</tr>
<tr>
<td>FloatField</td>
<td>浮点数字段, 值会被处理为浮点型</td>
<td><input type="text"></td>
</tr>
<tr>
<td>IntegerField</td>
<td>整数字段, 值会被处理为整数型</td>
<td><input type="text"></td>
</tr>
<tr>
<td>RadioField</td>
<td>一组单选按钮</td>
<td><input type="radio"></td>
</tr>
<tr>
<td>SelectField</td>
<td>下拉列表</td>
<td><select><option></option></select></td>
</tr>
<tr>
<td>SelectMultipleField</td>
<td>多选下拉列表</td>
<td><select multiple><option></option></select></td>
</tr>
<tr>
<td>SubmitField</td>
<td>提交按钮</td>
<td><input type="submit"></td>
</tr>
<tr>
<td>StringField</td>
<td>文本字段</td>
<td><input type="text"></td>
</tr>
<tr>
<td>HiddendField</td>
<td>隐藏文本字段</td>
<td><input type="hidden"></td>
</tr>
<tr>
<td>PasswordField</td>
<td>密码文本字段</td>
<td><input type="password"></td>
</tr>
<tr>
<td>TextAreaFiled</td>
<td>多行文本字段</td>
<td><textarea></textarea></td>
</tr>
</tbody></table>
<p><strong>字段类常用参数</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>label</td>
<td>字段标签<label>的值, 渲染后显示在输入字段前的内容</td>
</tr>
<tr>
<td>render_kw</td>
<td>一个字典, 用于设置对应的<input>标签的属性</td>
</tr>
<tr>
<td>validators</td>
<td>列表类型, 包含一系列验证器</td>
</tr>
<tr>
<td>default</td>
<td>字符串或可调用对象, 为表单字段设置默认值</td>
</tr>
</tbody></table>
<p><strong>WTForms验证器</strong></p>
<table>
<thead>
<tr>
<th>验证器</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>DataRequired(message=None)</td>
<td>验证数据是否有效</td>
</tr>
<tr>
<td>Email(message=None)</td>
<td>验证Email地址</td>
</tr>
<tr>
<td>EqualTo(fieldname, message=None)</td>
<td>验证两个字段值是否相同</td>
</tr>
<tr>
<td>InputRequired(message=None)</td>
<td>验证是否有数据</td>
</tr>
<tr>
<td>Length(min=-1, max=-1, message=None)</td>
<td>验证输入值是否在给定范围内</td>
</tr>
<tr>
<td>NumerRange(min=None, max=None, message=None)</td>
<td>验证数字是否在给定范围内</td>
</tr>
<tr>
<td>Optional(strip_whitespace=True)</td>
<td>允许输入值为空, 并跳过其他验证</td>
</tr>
<tr>
<td>Regexp(regex, flags=0, message=None)</td>
<td>使用正则验证输入值</td>
</tr>
<tr>
<td>URL(require_tld=True, message=None)</td>
<td>验证URL</td>
</tr>
<tr>
<td>AnyOf(values, message=None, values_formatter=None)</td>
<td>确保输入值在可选值列表值中</td>
</tr>
<tr>
<td>NoneOf(values, message=None, values_formatter=None)</td>
<td>确保输入值不在可选值列表中</td>
</tr>
</tbody></table>
<p>定义一个表单类, 实例化对象传入模板文件中使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> Form, StringField, PasswordField, SubmitField, BooleanField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired, Length</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(Form)</span>:</span></span><br><span class="line">    username = StringField(<span class="string">'Username'</span>, validators=[DataRequired()])</span><br><span class="line">    password = PasswordField(<span class="string">'Password'</span>, validators=[DataRequired(), length(<span class="number">8</span>, <span class="number">120</span>)])</span><br><span class="line">    remember = BooleanField(<span class="string">'Rememeber me'</span>)</span><br><span class="line">    submit = SubmitField(<span class="string">'Log in'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 实例化对象 调用方法生成HTML</span></span><br><span class="line"><span class="meta">@app.route('/basic')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">basic</span><span class="params">()</span>:</span></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>, form=form)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- login.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">    &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">    &#123;&#123; form.username &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &#123;&#123; form.password &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &#123;&#123; form.remember &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &#123;&#123; form.submit &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>validate_on_submit</code>函数判断表单字段是否通过验证, 验证成功则返回True, 反则会将错误消息添加到表单类的errors属性中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/basic', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">basic</span><span class="params">()</span>:</span></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        username = form.username.data</span><br><span class="line">        flash(<span class="string">'Welcome Home, %s!'</span> % username)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>, form=form)</span><br></pre></td></tr></table></figure>

<p>验证不通过打印错误消息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for message in form.username.errors %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>使用宏渲染表单字段, 可节省代码工作, 让其接收一个field字段对象和关键字参数。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- macros.html --&gt;</span></span><br><span class="line">&#123;% macro form_field(field) %&#125;</span><br><span class="line">&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">&#123;&#123; field.(**kwargs) &#125;&#125;</span><br><span class="line">&#123;% if field.errors %&#125;</span><br><span class="line">    &#123;% for message in field.errors %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>message<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure>

<p>在模板文件中使用宏：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% from 'macro.html' import form_field %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">    &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">    &#123;&#123; form_field(form.username) &#125;&#125;</span><br><span class="line">    &#123;&#123; form_field(form.password) &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义验证器"><a href="#自定义验证器" class="headerlink" title="自定义验证器"></a>自定义验证器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FortyTwoForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    answer = IntegerField(<span class="string">'The Number'</span>)</span><br><span class="line">    submit = SubmitField()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_answer</span><span class="params">(form, field)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> field.data != <span class="number">42</span>:</span><br><span class="line">            <span class="keyword">return</span> ValidationError(<span class="string">'Must be 42.'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="自定义通用验证器"><a href="#自定义通用验证器" class="headerlink" title="自定义通用验证器"></a>自定义通用验证器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_42</span><span class="params">(message=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> message <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        message = <span class="string">'Must be 42.'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_is_42</span><span class="params">(form, field)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> field != <span class="number">42</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(message)</span><br><span class="line">    <span class="keyword">return</span> _is_42</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Form</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    answer = IntegerField(<span class="string">'The Number'</span>, validators=[is_42()])</span><br></pre></td></tr></table></figure>

<h3 id="上传表单"><a href="#上传表单" class="headerlink" title="上传表单"></a>上传表单</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_from_directory</span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_filename</span><span class="params">(filename)</span>:</span></span><br><span class="line">    ext = os.path.splitext(filename)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> uuid.uuid4().hex + ext</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    photo = FileField(<span class="string">'Image'</span>, validators=[FileRequired(), FileAllowed([<span class="string">'jpg'</span>, <span class="string">'png'</span>, <span class="string">'gif'</span>])])</span><br><span class="line">    submit = SubmitField(<span class="string">'Submit'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('uploads/&lt;path:filename&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.config[<span class="string">'UPLOAD_PATH'</span>], filename)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('/show_images')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_images</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'uploaded.html'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route('/upload', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_image</span><span class="params">()</span>:</span></span><br><span class="line">    form = UploadForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        f = form.photo.data</span><br><span class="line">        filename = random_filename(f.filename)</span><br><span class="line">        f.save(os.path.join(app.config[<span class="string">'UPLOAD_PATH'</span>], filename))</span><br><span class="line">        session[<span class="string">'filename'</span>] = [filename]</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'show_images'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'upload.html'</span>, form=form)</span><br></pre></td></tr></table></figure>

<p>模板文件<code>uploaded.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Show Images<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('get_file', filename=session.filename)&#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SQLAlchemy拓展"><a href="#SQLAlchemy拓展" class="headerlink" title="SQLAlchemy拓展"></a>SQLAlchemy拓展</h3><p>安装拓展</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask_sqlalchemy</span><br></pre></td></tr></table></figure>

<p>配置数据库URI及实例化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = os.getenv(<span class="string">'DATABASE_URL'</span>, <span class="string">'sqlite:///'</span> + os.path.join(app.root_path + <span class="string">'data.db'</span>))</span><br></pre></td></tr></table></figure>

<p><strong>定义数据库模型</strong></p>
<p>模型类对应数据库中的表, 需继承自<code>db.Model</code>基类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __tablename__属性可指定表名, 默认为类名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    body = db.Column(db.Text)</span><br><span class="line">    </span><br><span class="line">db.create_all()</span><br></pre></td></tr></table></figure>

<p>SQLAlchemy常用字段类型</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Integer</td>
<td>整数</td>
</tr>
<tr>
<td>String</td>
<td>字符串, 可选参数length可设置最大长度</td>
</tr>
<tr>
<td>Text</td>
<td>较长的Unicode文本</td>
</tr>
<tr>
<td>Date</td>
<td>存储Python的datetime.date对象</td>
</tr>
<tr>
<td>Time</td>
<td>datetime.time对象</td>
</tr>
<tr>
<td>DateTime</td>
<td>datetime对象</td>
</tr>
<tr>
<td>Interval</td>
<td>datetime.timedelta对象</td>
</tr>
<tr>
<td>Float</td>
<td>浮点数</td>
</tr>
<tr>
<td>Boolean</td>
<td>布尔值</td>
</tr>
<tr>
<td>PickleType</td>
<td>存储Pickle列化的Python对象</td>
</tr>
<tr>
<td>LargeBinary</td>
<td>存储二进制数据</td>
</tr>
</tbody></table>
<p><strong>db.Column类参数</strong></p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>primary_key</td>
<td>设为True则该字段为主键</td>
</tr>
<tr>
<td>unique</td>
<td>设为True则该字段内容不可重复</td>
</tr>
<tr>
<td>index</td>
<td>设为True则为该字段设置索引, 提高查询效率</td>
</tr>
<tr>
<td>nullable</td>
<td>设为True则字段可为空</td>
</tr>
<tr>
<td>default</td>
<td>为字段设置默认值</td>
</tr>
<tr>
<td>***</td>
<td></td>
</tr>
</tbody></table>
<p><strong>SQLAlchemy查询方法, &lt;模型类&gt;.query.&lt;过滤方法&gt;.&lt;查询方法&gt;</strong></p>
<table>
<thead>
<tr>
<th>查询方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>all()</td>
<td>返回包含所有查询记录的列表</td>
</tr>
<tr>
<td>first()</td>
<td>返回查询的第一条记录, 如果未找到则返回None</td>
</tr>
<tr>
<td>one()</td>
<td>返回第一条记录, 且只允许有一条记录。不为一条则抛出错误</td>
</tr>
<tr>
<td>get(ident)</td>
<td>传入主键的值作为参数, 返回指定主键值的记录。未找到则为None</td>
</tr>
<tr>
<td>count()</td>
<td>返回查询结果集的数量</td>
</tr>
<tr>
<td>one_or_none()</td>
<td>类似one, 结果集不为1则返回None</td>
</tr>
<tr>
<td>first_or_404()</td>
<td>返回查询的第一条记录, 未找到则返回404响应</td>
</tr>
<tr>
<td>get_or_404(ident)</td>
<td>同上</td>
</tr>
<tr>
<td>paginate()</td>
<td>返回一个Paginate对象, 可对记录分页处理</td>
</tr>
</tbody></table>
<p><strong>SQLAlchemy常用过滤方法</strong></p>
<table>
<thead>
<tr>
<th>过滤器名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>filter()</td>
<td>使用指定的规则过滤, 返回新产生的查询对象</td>
</tr>
<tr>
<td>filter_by()</td>
<td>使用指定规则过滤记录(以关键字表达式的形式), 返回新产生的查询对象</td>
</tr>
<tr>
<td>order_by()</td>
<td>根据指定条件对记录进行排序, 返回新产生的查询对象</td>
</tr>
<tr>
<td>limit(limit)</td>
<td>使用指定的值限定原查询记录数量, 返回新产生的查询对象</td>
</tr>
<tr>
<td>group_by()</td>
<td>根据指定条件对记录进行分组, 返回新产生的查询对象</td>
</tr>
<tr>
<td>offset(offset)</td>
<td>使用指定的值偏移原查询的结果集, 返回新产生的查询对象</td>
</tr>
</tbody></table>
<p>使用filter过滤器查询body字段为<code>SHAVE</code>的记录。filter过滤器还可以使用如<code>like</code>, <code>in_</code>, <code>not in</code>, <code>and</code>, <code>or</code>等条件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Note.query.filter(Note.body==<span class="string">'SHAVE'</span>).first()</span><br><span class="line"><span class="comment"># 打印SQL语句</span></span><br><span class="line">print(Note.query.filter(Note.body==<span class="string">'SHAVE'</span>))</span><br><span class="line"><span class="comment"># like</span></span><br><span class="line">Note.query.filter(Note.body.like(<span class="string">'%foo%'</span>)).first()</span><br><span class="line"><span class="comment"># in</span></span><br><span class="line">Note.query.filter(Note.body.in_([<span class="string">'foo'</span>, <span class="string">'bar'</span>])).first()</span><br><span class="line"><span class="comment"># not in </span></span><br><span class="line">Note.query.filter(~Note.body.in_[<span class="string">'foo'</span>, <span class="string">'bar'</span>]).first()</span><br><span class="line"><span class="comment"># and </span></span><br><span class="line">Note.query.first(and_(Note.body == <span class="string">'foo'</span>, Note.title == <span class="string">'Foo'</span>))</span><br></pre></td></tr></table></figure>

<p><strong>更新记录</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">note = Note.query.get(<span class="number">2</span>)</span><br><span class="line">note.body = <span class="string">'New Content'</span></span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<p><strong>删除记录</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">note = Note.query.get(<span class="number">2</span>)</span><br><span class="line">db.session.delete(note)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<h3 id="实现添加新笔记视图"><a href="#实现添加新笔记视图" class="headerlink" title="实现添加新笔记视图"></a>实现添加新笔记视图</h3><p>模型类：app/models/NoteModel.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoteModel</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'note'</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    body = db.Column(db.Text)</span><br></pre></td></tr></table></figure>

<p>表单类：app\forms\NoteForm.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> TextAreaField, SubmitField</span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> DataRequired</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoteForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    body = TextAreaField(<span class="string">'Body'</span>, validators=[DataRequired()])</span><br><span class="line">    submit = SubmitField(<span class="string">'Save'</span>)</span><br></pre></td></tr></table></figure>

<p>应用程序：app\app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, flash, render_template,</span><br><span class="line">    redirect, url_for</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> NoteModel</span><br><span class="line">    </span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = os.getenv(<span class="string">'DATABASE_URL'</span>, <span class="string">'sqlite:///'</span> + os.path.join(app.root_path, <span class="string">'data.db'</span>))</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/new', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_note</span><span class="params">()</span>:</span></span><br><span class="line">    form = Note()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        body = form.body.data</span><br><span class="line">        note = NoteModel(body=body)</span><br><span class="line">        db.session.add(note)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">'Your Note Saved.'</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'new_note.html'</span>, form=form)</span><br></pre></td></tr></table></figure>

<p>模板：new_note.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>New Note<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>New Note<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">            &#123;&#123; form.body.label &#125;&#125;</span><br><span class="line">            &#123;&#123; form.body(rows=5, cols=50) &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            &#123;&#123; form.submit &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index视图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/index')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>

<p>模板：index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Note Book<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Note Book<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('new_note') &#125;&#125;"</span>&gt;</span>New Note<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>程序执行流程</strong></p>
<p>客户端（浏览器）访问路由<code>http://127.0.0.1/new</code>, new_note视图函数开始执行。 实例化Note类, 定义表和字段类型。当表单的提交按钮被点击时则<code>form.validate_on_submit</code>方法返回True, 进入分支代码块。 获取表单输入的内容后添加到数据库中, 然后跳转到index视图。</p>
<h4 id="修改首页视图和模板文件"><a href="#修改首页视图和模板文件" class="headerlink" title="修改首页视图和模板文件"></a>修改首页视图和模板文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/index')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    notes = Node.query.all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, notes=notes)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Note Book<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Note Book<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('new_note') &#125;&#125;"</span>&gt;</span>New Note<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123; notes|length &#125;&#125; notes:<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        &#123;% for note in notes %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>ID: &#123;&#123; note.id &#125;&#125; - 内容: &#123;&#123; note.body &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="编辑笔记内容"><a href="#编辑笔记内容" class="headerlink" title="编辑笔记内容"></a>编辑笔记内容</h4><p>编辑表单：app\forms\EditNote.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EditNoteForm</span><span class="params">(Note)</span>:</span></span><br><span class="line">    submit = SubmitField(<span class="string">'Update'</span>)</span><br></pre></td></tr></table></figure>

<p>编辑视图：app\app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/edit/&lt;int:note_id&gt;', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_note</span><span class="params">(note_id)</span>:</span></span><br><span class="line">    form = EditNoteForm()</span><br><span class="line">    note = Note.query.get(note_id)</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        note.body = form.body.data</span><br><span class="line">        db.session.commit()</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    form.body.data = note.body</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'edit_note.html'</span>, form=form)</span><br></pre></td></tr></table></figure>

<p>模板文件：edit_note.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Note Book<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Edit Note<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">            &#123;&#123; form.body.label &#125;&#125;</span><br><span class="line">            &#123;&#123; form.body &#125;&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            &#123;&#123; form.submit &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="删除笔记"><a href="#删除笔记" class="headerlink" title="删除笔记"></a>删除笔记</h4><p>删除表单：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeleteNoteForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    submit = SubmitField(<span class="string">'Delete'</span>)</span><br></pre></td></tr></table></figure>

<p>删除视图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/delete/&lt;int:note_id&gt;', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span><span class="params">(note_id)</span>:</span></span><br><span class="line">    form = DeleteNoteForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        note = Note.query.get(note_id)</span><br><span class="line">        db.session.delete(note)</span><br><span class="line">        db.session.commit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br></pre></td></tr></table></figure>

<p>在首页视图中实例化<code>删除表单对象</code>传入模板：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/index')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    note = Note.query.all()</span><br><span class="line">    form = DeleteNoteForm()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, note=note, form=form)</span><br></pre></td></tr></table></figure>

<h3 id="一对多表关系示例"><a href="#一对多表关系示例" class="headerlink" title="一对多表关系示例"></a>一对多表关系示例</h3><p>以作者表和文章表演示数据库一对多关系, 将<code>Article</code>表的<code>author_id</code>字段作为外键关联<code>Author</code>表的<code>id</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Author(db.Model):</span><br><span class="line">    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; db.Column(db.String(70), unique&#x3D;True)</span><br><span class="line">    phone &#x3D; db.Column(db.String(20))</span><br><span class="line">    </span><br><span class="line">class Article(db.Model):</span><br><span class="line">    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)</span><br><span class="line">    title &#x3D; db.Column(db.String(50), index&#x3D;True)</span><br><span class="line">    body &#x3D; db.Column(db.Text)</span><br><span class="line">    author_id &#x3D; db.Column(db.Integer, db.ForeignKey(&#39;author.id&#39;))</span><br></pre></td></tr></table></figure>

<p>定义关系属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    articles = db.relationship(<span class="string">'Article'</span>)</span><br></pre></td></tr></table></figure>

<p>添加数据并关联表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># flask shell 你可以像列表一样操作articles字段</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo = Author(name=<span class="string">'Foo'</span>, phone=<span class="string">'18888888888'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam = Article(title=<span class="string">'Spam'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ham = Article(title=<span class="string">'Ham'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(foo)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(spam)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(ham)</span><br><span class="line"><span class="comment"># 第一种方式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spam.author_id(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 第二种方式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo.articles.append(ham)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.commit()</span><br></pre></td></tr></table></figure>

<p>relationship关系函数参数</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>back_populates</td>
<td>定义反向引用, 用于建立双向关系。在关系的另一侧也必须显示定义属性</td>
</tr>
<tr>
<td>backref</td>
<td>添加反向引用, 自动在另一侧建立关系属性。是back_populates的简版</td>
</tr>
<tr>
<td>lazy</td>
<td>指定如何加载相关记录</td>
</tr>
<tr>
<td>uselist</td>
<td>指定是否使用列表的形式加载记录, 设为False则使用标量(scalar)</td>
</tr>
<tr>
<td>cascade</td>
<td>设置级联操作</td>
</tr>
<tr>
<td>order_by</td>
<td>指定加载相关记录时的排序方式</td>
</tr>
<tr>
<td>secondary</td>
<td>在多对多关系中指定关联表</td>
</tr>
<tr>
<td>primaryjoin</td>
<td>指定多对多关系中的一级联结条件</td>
</tr>
<tr>
<td>secondaryjoin</td>
<td>指定多对多关系中的二级联结条件</td>
</tr>
</tbody></table>
<p>上述表格中lazy参数的可选值</p>
<table>
<thead>
<tr>
<th>关系加载方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>select</td>
<td>在必要时一次性加载记录, 返回包含记录的列表, 等于lazy=True</td>
</tr>
<tr>
<td>joined</td>
<td>和父查询一样加载记录, 但使用联结, 等于lazy=False</td>
</tr>
<tr>
<td>immediate</td>
<td>一旦父查询加载就加载</td>
</tr>
<tr>
<td>subquery</td>
<td>类似于joined, 但使用子查询</td>
</tr>
<tr>
<td>dynamic</td>
<td>不直接加载记录, 而是返回一个包含相关记录的query对象, 以便再继续附加查询函数对结果进行过滤</td>
</tr>
</tbody></table>
<p>一对多关系的双向关系示例, 每本书对应多个作者, 每个作者对应多本书。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Writer</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">70</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    books = db.relationship(<span class="string">'Book'</span>, back_populates=<span class="string">'writer'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">50</span>), index=<span class="literal">True</span>)</span><br><span class="line">    writer_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'writer.id'</span>))</span><br><span class="line">    writer = db.relationship(<span class="string">'Writer'</span>, back_populates=<span class="string">'books'</span>)</span><br></pre></td></tr></table></figure>

<p>设置双向关系后, 即可通过将某个<code>Writer</code>对象赋值给<code>Book</code>对象的<code>writer</code>属性建立关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>king = Writer(name=<span class="string">'Stephen King'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>carrie = Book(title=<span class="string">'Carrie'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>it = Book(title=<span class="string">'IT'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(king)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(carrie)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.add(it)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.session.commit()</span><br><span class="line"><span class="comment"># 建立关系, 解除关系只需将标量属性设为None即可</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>carrie.writer = king</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>king.books</span><br></pre></td></tr></table></figure>

<h3 id="实战项目-SayHello"><a href="#实战项目-SayHello" class="headerlink" title="实战项目-SayHello"></a>实战项目-SayHello</h3><p>目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── LICENSE</span><br><span class="line">├── Pipfile</span><br><span class="line">├── Pipfile.lock</span><br><span class="line">├── README.md</span><br><span class="line">├── requirements.txt</span><br><span class="line">├── sayhello</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── commands.py</span><br><span class="line">│   ├── errors.py</span><br><span class="line">│   ├── forms.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── settings.py</span><br><span class="line">│   ├── static</span><br><span class="line">│   ├── templates</span><br><span class="line">│   └── views.py</span><br><span class="line">└── test_sayhello.py</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnl56prilsj33az0u07df.jpg" alt=""></p>
<p>首先编写项目的包构造文件, 实例化Flask类并导入全局配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sayhello <span class="keyword">import</span> app </span><br><span class="line"></span><br><span class="line">platform = sys.platform.startswith(<span class="string">'win'</span>)</span><br><span class="line"><span class="comment"># 判断操作系统</span></span><br><span class="line"><span class="keyword">if</span> platform:</span><br><span class="line">    prefix = <span class="string">'sqlite:///'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    prefix = <span class="string">'sqlite:////'</span></span><br><span class="line"></span><br><span class="line">SECRET_KEY = os.urandom(<span class="number">24</span>) <span class="comment"># 密钥</span></span><br><span class="line">SQLALCHEMY_DATABASE_URI = prefix + os.path.join(os.path.dirname(app.root_path), <span class="string">'data.db'</span>) <span class="comment"># 数据库路径</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __init__.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_bootstrap <span class="keyword">import</span> Bootstrap</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> flask_moment <span class="keyword">import</span> Moment</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_pyfile(<span class="string">'settings.py'</span>)</span><br><span class="line">app.jinja_env.rstrip_blocks = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">bootstrap = Bootstrap()</span><br><span class="line">db = SQLAlchemy()</span><br><span class="line">moment = Moment()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sayhello <span class="keyword">import</span> views, errors, commands</span><br></pre></td></tr></table></figure>

<p>下面编写模型类并注册flask命令：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> sayhello <span class="keyword">import</span> app, db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Message</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">20</span>))</span><br><span class="line">    body = db.Column(db.String(<span class="number">200</span>))</span><br><span class="line">    timestamp = db.Column(db.DateTime, default=datetime.utcnow, index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># commands.py</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"><span class="keyword">from</span> sayhello <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> sayhello.models <span class="keyword">import</span> Message</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option('--drop', is_flag=True, help='清空数据表生成虚拟数据')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forge</span><span class="params">(drop)</span>:</span></span><br><span class="line">    db.drop_all()</span><br><span class="line">    db.create_all()</span><br><span class="line">    click.echo(<span class="string">'数据已清空！'</span>)</span><br><span class="line">    fake = Faker(<span class="string">'zh_CN'</span>)</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        message = Message(</span><br><span class="line">            name = fake.name(),</span><br><span class="line">            body = fake.sentence(),</span><br><span class="line">            timestamp = fake.date_time_this_year()</span><br><span class="line">        )</span><br><span class="line">        db.session.add(message)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    click.echo(<span class="string">'已生成虚拟数据添加至数据库中！'</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>flask forge</code>命令即可生成20条虚假数据至数据库中, 下面编写表单及视图类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms.py</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms.valiadtors <span class="keyword">import</span> DataRequired, Length</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, TextAreaField, SubmitField</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    name = StringField(<span class="string">'Name'</span>, validators=[DataRequired(), Length(<span class="number">1</span>,<span class="number">20</span>)])</span><br><span class="line">    body = TextAreaField(<span class="string">'Message'</span>, validators=[DataRequired, Length(<span class="number">1</span>,<span class="number">200</span>)])</span><br><span class="line">    submit = SubmitField()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template, redirect, url_for, flash</span><br><span class="line"><span class="keyword">from</span> sayhello <span class="keyword">import</span> app, db</span><br><span class="line"><span class="keyword">from</span> sayhello.forms <span class="keyword">import</span> HelloForm</span><br><span class="line"><span class="keyword">from</span> sayhello.models <span class="keyword">import</span> Message</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    form = HelloForm()</span><br><span class="line">    message = Message.query.order_by(Message.timestamp.desc()).all()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        name = form.name.data</span><br><span class="line">        body = form.body.data</span><br><span class="line">        message = Message(</span><br><span class="line">            name = name,</span><br><span class="line">            body = body</span><br><span class="line">        )</span><br><span class="line">        db.session.add(message)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">'你的留言已发送至全世界！'</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, form=form, messages=messages)</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnl61rte0fj31730u0aes.jpg" alt=""></p>
<h3 id="蓝图"><a href="#蓝图" class="headerlink" title="蓝图"></a>蓝图</h3><p><strong>Blueprint 是一种组织一组相关视图及其他代码的方式。与把视图及其他 代码直接注册到应用的方式不同，蓝图方式是把它们注册到蓝图，然后在工厂函数中 把蓝图注册到应用。 – Flask官方文档</strong></p>
<hr>
<p>注册博客前台蓝图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">blog_bp = Blueprint(<span class="string">'blog'</span>, __name__)</span><br></pre></td></tr></table></figure>

<p>在实例化蓝图时可以指定<code>url_prefix</code>或<code>subdomain</code>, 在对应的视图函数中则会自动添加这些前缀无需声明。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">auth_bp = Blueprint(<span class="string">'auth'</span>, __name__, url_prefix=<span class="string">'auth'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">admin_bp = Blueprint('admin', __name__, subdomain='admin')</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<p><a href="https://flask.palletsprojects.com/en/1.1.x/api/#flask.Blueprint" target="_blank" rel="noopener">Blueprint API Documentation</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/exp1orer" target="_blank" rel="noopener">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义视图函数及路由"><span class="toc-number">1.</span> <span class="toc-text">定义视图函数及路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基础"><span class="toc-number">2.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#视图钩子"><span class="toc-number">3.</span> <span class="toc-text">视图钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP响应"><span class="toc-number">4.</span> <span class="toc-text">HTTP响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make-response函数"><span class="toc-number">5.</span> <span class="toc-text">make_response函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Response对象"><span class="toc-number">6.</span> <span class="toc-text">Response对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask上下文变量"><span class="toc-number">7.</span> <span class="toc-text">Flask上下文变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板内置上下文"><span class="toc-number">8.</span> <span class="toc-text">模板内置上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板自定义上下文"><span class="toc-number">9.</span> <span class="toc-text">模板自定义上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JinJa2模板引擎全局函数"><span class="toc-number">10.</span> <span class="toc-text">JinJa2模板引擎全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask内置的模板全局函数"><span class="toc-number">11.</span> <span class="toc-text">Flask内置的模板全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义模板全局函数"><span class="toc-number">12.</span> <span class="toc-text">自定义模板全局函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过滤器"><span class="toc-number">13.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义过滤器"><span class="toc-number">14.</span> <span class="toc-text">自定义过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试器"><span class="toc-number">15.</span> <span class="toc-text">测试器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义注册器"><span class="toc-number">16.</span> <span class="toc-text">自定义注册器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板环境对象"><span class="toc-number">17.</span> <span class="toc-text">模板环境对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部模板"><span class="toc-number">18.</span> <span class="toc-text">局部模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板继承"><span class="toc-number">19.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载静态文件"><span class="toc-number">20.</span> <span class="toc-text">加载静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消息闪现"><span class="toc-number">21.</span> <span class="toc-text">消息闪现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义错误页面"><span class="toc-number">22.</span> <span class="toc-text">自定义错误页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-WTF处理表单"><span class="toc-number">23.</span> <span class="toc-text">Flask-WTF处理表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义验证器"><span class="toc-number">24.</span> <span class="toc-text">自定义验证器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义通用验证器"><span class="toc-number">25.</span> <span class="toc-text">自定义通用验证器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传表单"><span class="toc-number">26.</span> <span class="toc-text">上传表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLAlchemy拓展"><span class="toc-number">27.</span> <span class="toc-text">SQLAlchemy拓展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现添加新笔记视图"><span class="toc-number">28.</span> <span class="toc-text">实现添加新笔记视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改首页视图和模板文件"><span class="toc-number">28.1.</span> <span class="toc-text">修改首页视图和模板文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编辑笔记内容"><span class="toc-number">28.2.</span> <span class="toc-text">编辑笔记内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除笔记"><span class="toc-number">28.3.</span> <span class="toc-text">删除笔记</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多表关系示例"><span class="toc-number">29.</span> <span class="toc-text">一对多表关系示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实战项目-SayHello"><span class="toc-number">30.</span> <span class="toc-text">实战项目-SayHello</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#蓝图"><span class="toc-number">31.</span> <span class="toc-text">蓝图</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&text=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&is_video=false&description=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=《Flask Web开发实战》笔记&body=Check out this article: http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&title=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&name=《Flask Web开发实战》笔记&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://yoursite.com/2021/02/08/%E3%80%8AFlask-Web%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/&t=《Flask Web开发实战》笔记" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2022
    Search?=Null
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/exp1orer" target="_blank" rel="noopener">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
